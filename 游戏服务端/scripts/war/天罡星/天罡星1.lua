-- @Author              : GGELUA
-- @Last Modified by    : baidwwy
-- @Date                : 2023-07-18 00:33:41
-- @Last Modified time  : 2023-08-06 23:15:16

local 战斗 = {}

local _名称 = {
    '地狗星', '地英星', '地奇星', '地猛星', '地平星', '地会星', '地佐星', '地灵星', '地兽星', '地幽星',
    '地捷星', '地镇星', '地稽星', '地异星', '地退星', '地满星', '地遂星', '地理星', '地微星', '地全星',
    '地短星', '地角星', '地丑星', '地数星', '地阴星', '地刑星', '地壮星', '地嵇星', '地明星', '地乐星',
    '地慧星', '地俊星', '地空星', '地孤星', '地佑星', '地耗星', '地贼星', '地伏星', '地暴星', '地正星',
    '地强星', '地奴星', '地察星', '地隐星', '地巧星', '地飞星', '地默星', '地文星', '地然星', '地彗星',
}

local _怪物 = {
    强混 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('男人', 转生)
        end,
        等级 = 170,
        气血 = 7600000,
        魔法 = 120000,
        攻击 = 25600,
        速度 = 5000,
        抗性 = {
            抗混乱 = 150,
            抗封印 = 150,
            抗昏睡 = 200,
            抗中毒 = 72,
            抗风 = 55,
            抗火 = 55,
            抗水 = 55,
            抗雷 = 55,
            加强混乱 = 24,
            加强封印 = 24,
            加强昏睡 = 24,
            忽视抗混 = 12,
            忽视抗印 = 12,
            忽视抗睡 = 12,
            加强毒 = 60,
            忽视抗毒 = 42,
            抗震慑 = 18,
            物理吸收 = 120,
            躲闪率 = 45,
        },
        技能 = {
            { 名称 = "借刀杀人", 熟练度 = 25000 },
            { 名称 = "失心狂乱", 熟练度 = 25000 },
        },
        施法几率 = 100,
        是否消失 = false,
    },
    强毒 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('女人', 转生)
        end,
        等级 = 170,
        气血 = 7600000,
        魔法 = 120000,
        攻击 = 25600,
        速度 = 5000,
        抗性 = {
            抗混乱 = 150,
            抗封印 = 150,
            抗昏睡 = 150,
            抗中毒 = 150,
            抗风 = 55,
            抗火 = 55,
            抗水 = 55,
            抗雷 = 55,
            加强混乱 = 24,
            加强封印 = 24,
            加强昏睡 = 24,
            忽视抗混 = 12,
            忽视抗印 = 12,
            忽视抗睡 = 12,
            加强毒 = 60,
            忽视抗毒 = 42,
            抗震慑 = 18,
            物理吸收 = 75,
            躲闪率 = 45,
        },
        技能 = {
            { 名称 = "鹤顶红粉", 熟练度 = 25000 },
            { 名称 = "万毒攻心", 熟练度 = 25000 },
        },
        施法几率 = 100,
        是否消失 = false,
    },
    冰睡 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('人族', 转生)
        end,
        等级 = 170,
        气血 = 6600000,
        魔法 = 120000,
        攻击 = 25600,
        速度 = 5000,
        抗性 = {
            抗混乱 = 150,
            抗封印 = 150,
            抗昏睡 = 150,
            抗中毒 = 72,
            抗风 = 55,
            抗火 = 55,
            抗水 = 55,
            抗雷 = 55,
            加强混乱 = 24,
            加强封印 = 24,
            加强昏睡 = 24,
            忽视抗混 = 12,
            忽视抗印 = 12,
            忽视抗睡 = 12,
            加强毒 = 60,
            忽视抗毒 = 42,
            抗震慑 = 18,
            物理吸收 = 75,
            躲闪率 = 45,
        },
        技能 = {
            { 名称 = "迷魂醉", 熟练度 = 25000 },
            { 名称 = "百日眠", 熟练度 = 25000 },
            { 名称 = "作壁上观", 熟练度 = 25000 },
            { 名称 = "四面楚歌", 熟练度 = 25000 },
        },
        施法几率 = 100,
        是否消失 = false,
    },
    男魔 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('男魔', 转生)
        end,
        等级 = 170,
        气血 = 6400000,
        魔法 = 600000,
        攻击 = 55600,
        速度 = 6500,
        抗性 = {
            抗混乱 = 150,
            抗封印 = 150,
            抗昏睡 = 150,
            抗风 = 60,
            抗火 = 60,
            抗水 = 60,
            抗雷 = 60,
            致命几率 = 5,
            狂暴几率 = 5,
            连击率 = 60,
            连击次数 = 7,
            附加震慑攻击 = 60,
            抗震慑 = 22,
            物理吸收 = 100,
        },
        技能 = {
            { 名称 = "魔神附身", 熟练度 = 25000 },
            { 名称 = "乾坤借速", 熟练度 = 25000 },
            { 名称 = "阎罗追命", 熟练度 = 25000 },
        },
        施法几率 = 100,
        是否消失 = false,
    },
    女魔 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('女魔', 转生)
        end,
        等级 = 170,
        气血 = 6400000,
        魔法 = 600000,
        攻击 = 55600,
        速度 = 4600,
        抗性 = {
            抗混乱 = 150,
            抗封印 = 150,
            抗昏睡 = 150,
            抗风 = 60,
            抗火 = 60,
            抗水 = 60,
            抗雷 = 60,
            致命几率 = 70,
            狂暴几率 = 75,
            连击率 = 60,
            连击次数 = 7,
            附加震慑攻击 = 60,
            抗震慑 = 22,
            物理吸收 = 75,
			命中率 = 27,
        },
        技能 = {
            { 名称 = "魔神附身", 熟练度 = 25000 },
            { 名称 = "含情脉脉", 熟练度 = 25000 },
            { 名称 = "阎罗追命", 熟练度 = 25000 },
        },
        施法几率 = 50,
        是否消失 = false,
    },
    大力 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('魔族', 转生)
        end,
        等级 = 170,
        气血 = 4600000,
        魔法 = 600000,
        攻击 = 124560,
        速度 = 4900,
        抗性 = {
            抗混乱 = 140,
            抗封印 = 140,
            抗昏睡 = 140,
            抗风 = 60,
            抗火 = 60,
            抗水 = 60,
            抗雷 = 60,
            致命几率 = 75,
            狂暴几率 = 60,
            连击率 = 70,
            连击次数 = 7,
            反击率 = 75,
            反击次数 = 7,
            忽视防御几率 = 100,
            忽视防御程度 = 150,
            抗震慑 = 22,
            物理吸收 = 100,
			命中率 = 27,
        },
        是否消失 = false,
    },
    男仙 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('男仙', 转生)
        end,
        等级 = 170,
        气血 = 7600000,
        魔法 = 200000,
        攻击 = 18600,
        速度 = 4788,
        抗性 = {
            抗混乱 = 140,
            抗封印 = 140,
            抗昏睡 = 140,
            抗风 = 120,
            抗火 = 120,
            抗水 = 120,
            抗雷 = 120,
            加强雷 = 60,
            加强火 = 60,
            加强风 = 60,
            加强水 = 60,
            忽视抗雷 = 42,
            忽视抗火 = 42,
            忽视抗风 = 42,
            忽视抗水 = 42,
            雷系狂暴几率 = 36,
            火系狂暴几率 = 36,
            风系狂暴几率 = 36,
            水系狂暴几率 = 36,
            雷系狂暴程度 = 54,
            火系狂暴程度 = 54,
            风系狂暴程度 = 54,
            水系狂暴程度 = 54,
            抗震慑 = 18,
            躲闪率 = 75,
            物理吸收 = 60,
        },
        技能 = {
            { 名称 = "天诛地灭", 熟练度 = 25000 },
            { 名称 = "九龙冰封", 熟练度 = 25000 },
            { 名称 = "袖里乾坤", 熟练度 = 25000 },
        },
        施法几率 = 100,
        是否消失 = false,
    },
    女仙 = {
        名称 = function()
            return _名称[math.random(#_名称)]
        end,
        外形 = function(等级, 转生)
            return 随机种族模型('女仙', 转生)
        end,
        等级 = 170,
        气血 = 7600000,
        魔法 = 120000,
        攻击 = 18600,
        速度 = -1100,
        抗性 = {
            抗混乱 = 140,
            抗封印 = 140,
            抗昏睡 = 140,
            抗风 = 120,
            抗火 = 120,
            抗水 = 120,
            抗雷 = 120,
            加强雷 = 60,
            加强火 = 60,
            加强风 = 60,
            加强水 = 60,
            忽视抗雷 = 150,
            忽视抗火 = 150,
            忽视抗风 = 150,
            忽视抗水 = 150,
            雷系狂暴几率 = 36,
            火系狂暴几率 = 36,
            风系狂暴几率 = 36,
            水系狂暴几率 = 36,
            雷系狂暴程度 = 150,
            火系狂暴程度 = 150,
            风系狂暴程度 = 150,
            水系狂暴程度 = 150,
            抗震慑 = 18,
            躲闪率 = 75,
            物理吸收 = 60,
        },
        技能 = {
            { 名称 = "天诛地灭", 熟练度 = 25000 },
            { 名称 = "九龙冰封", 熟练度 = 25000 },
            { 名称 = "九阴纯火", 熟练度 = 25000 },
        },
        施法几率 = 100,
        是否消失 = false,
    },
}

local _类型 = {
    '强混', '强毒', '冰睡', '男魔', '女魔', '大力', '男仙', '女仙'
}

function 战斗:战斗初始化(玩家, NPC)
    local 转生 = 3
    local 等级 = 170
    local list = {}
    for i = 1, 10 do
        local v = _怪物[_类型[math.random(#_类型)]]
        table.insert(list, v)
    end
    for i, v in ipairs(list) do
        local t = {}
        for k, s in pairs(v) do
            if type(s) == "function" then
                t[k] = s(等级, 转生)
            else
                t[k] = s
            end
        end
        if i == 1 then
            t.名称 = NPC.名称
        end
        local r = 生成战斗怪物(t)
        self:加入敌方(i, r)
    end
end

function 战斗:战斗回合开始(v)
end

function 战斗:战斗回合结束(v)
end

function 战斗:战斗开始(v)
end

function 战斗:战斗结束(s)
end

return 战斗